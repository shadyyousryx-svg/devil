<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ© - Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø°ÙƒÙŠ</title>
    
    <meta name="theme-color" content="#d32f2f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ©">
    <meta name="application-name" content="Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ©">

    <link rel="icon" type="image/jpeg" href="https://i.ibb.co/bRzWVmPC/logo.jpg">
    <link rel="apple-touch-icon" href="https://i.ibb.co/bRzWVmPC/logo.jpg">
    
    <link rel="manifest" href="data:application/manifest+json;charset=utf-8,%7B%22name%22%3A%22%D9%85%D8%B7%D8%B9%D9%85%20%D8%A7%D9%84%D8%A8%D8%B1%D9%83%D8%A9%22%2C%22short_name%22%3A%22%D9%85%D8%B7%D8%B9%D9%85%20%D8%A7%D9%84%D8%A8%D8%B1%D9%83%D8%A9%22%2C%22start_url%22%3A%22.%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23f8f9fa%22%2C%22theme_color%22%3A%22%23d32f2f%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22https%3A%2F%2Fi.ibb.co%2FbRzWVmPC%2Flogo.jpg%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fjpeg%22%7D%5D%7D">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --main-red: #d32f2f; --main-yellow: #ffc107; 
            --bg: #f8f9fa; --text: #2d3436; --card-bg: #ffffff;
        }
        [data-theme="dark"] {
            --bg: #121212; --text: #ffffff; --card-bg: #1e1e1e;
        }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; transition: 0.3s; padding-bottom: 80px; }
        
        #home-page { 
            height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://i.ibb.co/HTWhBfwz/Untitled-Project-7.jpg');
            background-size: cover; background-position: center; color: white; text-align: center; padding: 20px;
        }
        .home-logo { width: 140px; border-radius: 50%; border: 4px solid var(--main-yellow); margin-bottom: 15px; background:white; }
        
        .info-tag { display: block; background: var(--main-yellow); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-bottom: 10px; font-size: 0.9rem; }
        .alert-tag { background: var(--main-red); color: white; border: 1px solid white; }

        .start-btn { background: var(--main-red); color: white; border: none; padding: 15px 50px; font-size: 1.3rem; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4); margin-top: 10px; }
        .start-btn:disabled { background: #888; cursor: not-allowed; box-shadow: none; }
        .start-btn:active { transform: scale(0.95); }

        .header { background: var(--main-red); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .tabs { display: flex; overflow-x: auto; background: var(--card-bg); padding: 10px; gap: 8px; border-bottom: 1px solid #ddd; scroll-behavior: smooth; }
        .tab { white-space: nowrap; padding: 8px 18px; border-radius: 20px; border: 1px solid var(--main-red); background: none; color: var(--main-red); font-weight: bold; cursor: pointer; }
        .tab.active { background: var(--main-red); color: white; }

        .item-card { display: flex; background: var(--card-bg); margin: 12px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer; height: 110px; border: 1px solid #eee; }
        .item-card img { width: 110px; height: 110px; object-fit: cover; }
        .item-info { padding: 10px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .item-info h3 { margin: 0; font-size: 0.95rem; }
        .price-tag { color: var(--main-red); font-weight: bold; margin-top: 5px; }

        .page-content { display: none; padding-bottom: 120px; }
        .opt-box { background: var(--card-bg); margin: 15px; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
        select, input[type="text"], input[type="time"], textarea { width: 100%; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Cairo'; box-sizing: border-box; background: var(--bg); color: var(--text); }

        #custom-alert {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--card-bg); border: 2px solid var(--main-red); padding: 20px; border-radius: 15px;
            z-index: 2000; box-shadow: 0 0 20px rgba(0,0,0,0.5); width: 80%; max-width: 300px; text-align: center;
        }
        #alert-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1999;
        }

        .qty-controls { display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 10px; }
        .qty-btn { background: var(--main-yellow); border: none; width: 40px; height: 40px; border-radius: 10px; font-weight: bold; font-size: 1.2rem; cursor: pointer; }

        .footer { position: fixed; bottom: 0; width: 100%; background: var(--card-bg); border-top: 2px solid var(--main-red); z-index: 1000; }
        .nav-bar { display: flex; justify-content: space-around; padding: 10px; background: rgba(0,0,0,0.02); }
        .nav-item { border: none; background: none; color: var(--text); font-family: 'Cairo'; font-size: 0.8rem; cursor: pointer; font-weight: bold; position: relative; }
        .cart-count { position: absolute; top: -8px; right: -15px; background: var(--main-yellow); color: #000; padding: 2px 7px; border-radius: 50%; font-size: 0.75rem; font-weight: bold; }
        
        .contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .c-btn { text-decoration: none; color: white; padding: 10px; border-radius: 8px; font-size: 0.8rem; text-align: center; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .c-btn.red { background: var(--main-red); }
        .c-btn.insta { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .c-btn.fb { background: #1877F2; }
        .c-btn.call { background: #2d3436; }
        
        .radio-label { display: flex; align-items: center; cursor: pointer; font-weight: bold; }
        .radio-label input { margin-left: 5px; transform: scale(1.1); margin-top: 0; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="alert-overlay"></div>
<div id="custom-alert">
    <p id="alert-text" style="font-weight: bold; margin-bottom: 20px;"></p>
    <button onclick="closeAlert()" style="background: var(--main-red); color: white; border: none; padding: 8px 25px; border-radius: 5px; cursor: pointer;">Ø­Ø³Ù†Ø§Ù‹</button>
</div>

<div id="home-page">
    <img src="https://i.ibb.co/bRzWVmPC/logo.jpg" class="home-logo" alt="Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ©">
    <h1 style="margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ© ğŸ—</h1>
    
    <div class="info-tag alert-tag">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø¶ÙˆØ± Ùˆ Ø§Ø³ØªÙ„Ø§Ù… ÙÙ‚Ø·</div>
    <button class="start-btn" id="start-btn" onclick="goToMenu()" disabled>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â³...</button>
    <div style="margin-top: 20px; font-size: 0.9rem; opacity: 0.9;">ğŸ“ Ø§Ù„Ø®ÙˆØ¶ | Ø§Ù„Ø®ÙˆÙŠØ±</div>
</div>

<div id="menu-page" class="page-content">
    <div class="header">
        <button onclick="goToHome()" style="background:none; border:none; color:white; font-size:1.5rem;">ğŸ </button>
        <span style="font-weight:bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</span>
        <span></span>
    </div>
    <div class="tabs" id="cat-tabs"></div>
    <div id="items-list"></div>
</div>

<div id="options-page" class="page-content">
    <div class="header">
        <button onclick="backToCurrentCategory()" style="background:none; border:none; color:white;">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
        <span id="item-title-head">ØªØ®ØµÙŠØµ Ø§Ù„ÙˆØ¬Ø¨Ø©</span>
        <span></span>
    </div>
    <div id="options-render"></div>
    <div class="opt-box">
        <label style="text-align: center; display: block; font-weight: bold;">ğŸ”¢ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</label>
        <div class="qty-controls">
            <button class="qty-btn" onclick="changeOptQty(-1)">-</button>
            <span id="opt-qty-val" style="font-size: 1.2rem; font-weight: bold;">1</span>
            <button class="qty-btn" onclick="changeOptQty(1)">+</button>
        </div>
    </div>
    <div style="padding: 15px;">
        <button class="start-btn" style="width:100%" onclick="addItemToCart()">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ğŸ›’</button>
    </div>
</div>

<div id="cart-page" class="page-content">
    <div class="header">
        <span>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
        <button onclick="backToCurrentCategory()" style="background:none; border:none; color:white; font-weight:bold;">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
    </div>

    <div class="opt-box" style="background: #ffebee; border-color: var(--main-red); text-align: center; padding: 10px;">
        <span style="color: var(--main-red); font-weight: bold; font-size: 0.9rem;">âš ï¸ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹ ÙÙ‚Ø·.</span>
    </div>
    
    <div class="opt-box" style="padding: 12px;">
        <label style="color:var(--main-red); font-weight:bold; font-size: 0.9rem;">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
        <input type="text" id="customer-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…..." style="border: 2px solid var(--main-red); font-weight:bold; padding: 8px;">
    </div>

    <div class="opt-box" style="padding: 12px;">
        <label id="branch-label" style="color:var(--main-red); font-weight:bold; font-size: 0.9rem;">ğŸ“ Ø§Ø®ØªØ± ÙØ±Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</label>
        <select id="branch-select" style="border: 2px solid var(--main-red); font-weight:bold; padding: 8px;">
            <option value="">-- Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ --</option>
            <option value="ÙØ±Ø¹ Ø§Ù„Ø®ÙˆØ¶ - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¨Ø±ÙƒØ§Øª">ÙØ±Ø¹ Ø§Ù„Ø®ÙˆØ¶ - Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¨Ø±ÙƒØ§Øª</option>
            <option value="ÙØ±Ø¹ Ø§Ù„Ø®ÙˆÙŠØ± - Ø´Ø§Ø±Ø¹ Ø³ÙˆÙ‚ Ø§Ù„Ø®ÙˆÙŠØ±">ÙØ±Ø¹ Ø§Ù„Ø®ÙˆÙŠØ± - Ø´Ø§Ø±Ø¹ Ø³ÙˆÙ‚ Ø§Ù„Ø®ÙˆÙŠØ±</option>
        </select>
    </div>

    <div class="opt-box" id="time-selection-box" style="padding: 12px;">
        <label style="color:var(--main-red); font-weight:bold; font-size: 0.9rem; margin-bottom: 8px; display: block;">ğŸ•’ Ù…ØªÙ‰ ØªØ±ØºØ¨ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ØŸ</label>
        
        <div style="display: flex; gap: 15px; background: var(--bg); padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
            <label class="radio-label" style="font-size: 0.85rem; margin:0;">
                <input type="radio" name="pickup-time-type" value="asap" checked onchange="toggleTimeInput()"> 
                Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª (<span id="asap-time-span">20</span> Ø¯)
            </label>
            <label class="radio-label" style="font-size: 0.85rem; margin:0;">
                <input type="radio" name="pickup-time-type" value="scheduled" onchange="toggleTimeInput()"> 
                ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª
            </label>
        </div>

        <div id="scheduled-time-container" style="display: none; margin-top: 10px; animation: fadeIn 0.3s ease;">
            <label style="font-size: 0.75rem; color: #666; display: block; margin-bottom: 5px;">* Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† 15 Ø¯Ù‚ÙŠÙ‚Ø©):</label>
            <select id="scheduled-time-select" style="border: 2px solid var(--main-red); font-weight:bold; padding: 8px; font-size: 0.9rem; border-radius: 6px; color: var(--main-red);">
            </select>
        </div>
    </div>

    <div class="opt-box" style="padding: 12px;">
        <label style="color:var(--text); font-weight:bold; font-size: 0.9rem;">ğŸš— Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
        <textarea id="pickup-notes" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£Ùˆ Ø§Ù„Ù„ÙˆÙ† Ù„ØªØ³Ù‡ÙŠÙ„ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ù„Ùƒ..." style="border: 1px solid #ddd; padding: 8px; font-size: 0.85rem; height: 60px;"></textarea>
    </div>

    <div id="cart-display"></div>

    <div class="opt-box" style="text-align: center;">
        <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <span id="total-val" style="color:var(--main-red);">0.000</span> Ø±.Ø¹</h3>
        <button class="start-btn" style="width:100%; background:#25D366; font-size:1.1rem;" onclick="submitOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨) ğŸ’¬</button>
    </div>
    
    <div class="contact-grid">
        <a href="tel:99876514" class="c-btn call" id="call-btn-1">ğŸ“ 99876514</a>
        <a href="tel:90664108" class="c-btn call" id="call-btn-2">ğŸ“ 90664108</a>
        <a href="https://maps.app.goo.gl/5ZAGoYCSfwv2YurZ6" class="c-btn red" id="loc-btn-1">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®ÙˆØ¶</a>
        <a href="https://maps.app.goo.gl/XpQSv5umViVYo7jX7" class="c-btn red" id="loc-btn-2">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®ÙˆÙŠØ±</a>
        <a href="https://www.instagram.com/elbarakafriedchicken.oman/" target="_blank" class="c-btn insta" id="insta-btn">ğŸ“¸ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</a>
        <a href="https://www.facebook.com/profile.php?id=61564286235956" target="_blank" class="c-btn fb" id="fb-btn">ğŸ“˜ ÙÙŠØ³Ø¨ÙˆÙƒ</a>
    </div>
</div>

<div class="footer" id="footer-nav" style="display:none">
    <div class="nav-bar">
        <button class="nav-item" onclick="backToCurrentCategory()">ğŸ´ Ø§Ù„Ù…Ù†ÙŠÙˆ</button>
        <button class="nav-item" onclick="goToCart()">
            ğŸ›’ Ø§Ù„Ø³Ù„Ø© <span class="cart-count" id="c-count">0</span>
        </button>
    </div>
</div>

<script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS_mLvfHoHl4JY7Njpl7mfVL1gXbhg_tBbGyi-NWLacXPmRmPornWAg7bqDBGdNya2Ky_haLSvuBD6j/pub?output=csv";
    
    let deliveryTime = "20"; 
    let whatsappNumber = "96892018510";
    let callNumber1 = "99876514";
    let callNumber2 = "90664108";
    let instaLink = "https://www.instagram.com/elbarakafriedchicken.oman/";
    let fbLink = "https://www.facebook.com/profile.php?id=61564286235956";
    let locationLink1 = "https://maps.app.goo.gl/5ZAGoYCSfwv2YurZ6";
    let locationLink2 = "https://maps.app.goo.gl/XpQSv5umViVYo7jX7";

    const saucesUI = `
        <option value="ØµÙˆØµ Ø±Ø§Ù†Ø´">ØµÙˆØµ Ø±Ø§Ù†Ø´</option>
        <option value="ØµÙˆØµ Ø¨Ø§Ø±Ø¨ÙŠÙƒÙˆ">ØµÙˆØµ Ø¨Ø§Ø±Ø¨ÙŠÙƒÙˆ</option>
        <option value="ØµÙˆØµ ÙƒÙˆÙƒØªÙŠÙ„">ØµÙˆØµ ÙƒÙˆÙƒØªÙŠÙ„</option>
        <option value="ØµÙˆØµ Ø­Ø§Ø±">ØµÙˆØµ Ø­Ø§Ø±</option>
        <option value="ØµÙˆØµ Ø³ÙˆÙŠØª Ø´ÙŠÙ„ÙŠ">ØµÙˆØµ Ø³ÙˆÙŠØª Ø´ÙŠÙ„ÙŠ</option>
        <option value="ØµÙˆØµ Ø«ÙˆÙ…ÙŠÙ‡">ØµÙˆØµ Ø«ÙˆÙ…ÙŠÙ‡</option>
        <option value="Ø­Ù„Ù‚Ø§Øª Ù‡Ø§Ù„Ø¨ÙŠÙ†Ùˆ">Ø­Ù„Ù‚Ø§Øª Ù‡Ø§Ù„Ø¨ÙŠÙ†Ùˆ</option>
    `;
    
    const drinksUI = `
        <option value="Ø§Ù„Ø³ÙŠ ÙƒÙˆÙ„Ø§">Ø§Ù„Ø³ÙŠ ÙƒÙˆÙ„Ø§</option>
        <option value="Ø§Ù„Ø³ÙŠ ØªÙØ§Ø­">Ø§Ù„Ø³ÙŠ ØªÙØ§Ø­</option>
        <option value="Ø§Ù„Ø³ÙŠ ÙƒÙˆÙ„Ø§ Ø¯Ø§ÙŠØª">Ø§Ù„Ø³ÙŠ ÙƒÙˆÙ„Ø§ Ø¯Ø§ÙŠØª</option>
        <option value="Ø§Ù„Ø³ÙŠ Ù„ÙŠÙ…ÙˆÙ†">Ø§Ù„Ø³ÙŠ Ù„ÙŠÙ…ÙˆÙ†</option>
        <option value="Ø§Ù„Ø³ÙŠ Ø³ØªØ±ÙŠÙ…">Ø§Ù„Ø³ÙŠ Ø³ØªØ±ÙŠÙ…</option>
        <option value="Ø§Ù„Ø³ÙŠ Ø¨Ø±ØªÙ‚Ø§Ù„">Ø§Ù„Ø³ÙŠ Ø¨Ø±ØªÙ‚Ø§Ù„</option>
        <option value="Ø§Ù„Ø³ÙŠ Ø­Ù…Ø¶ÙŠØ§Øª">Ø§Ù„Ø³ÙŠ Ø­Ù…Ø¶ÙŠØ§Øª</option>
    `;

    let menuData = {};
    let cart = [];
    let selectedItem = null;
    let currentOptQty = 1;
    let currentCategory = ""; 

    function showAlert(text) {
        document.getElementById('alert-text').innerText = text;
        document.getElementById('alert-overlay').style.display = 'block';
        document.getElementById('custom-alert').style.display = 'block';
    }
    function closeAlert() {
        document.getElementById('alert-overlay').style.display = 'none';
        document.getElementById('custom-alert').style.display = 'none';
    }

    function generateTimeOptions() {
        const select = document.getElementById('scheduled-time-select');
        select.innerHTML = '';
        const now = new Date();
        let currentMins = now.getHours() * 60 + now.getMinutes();
        let startMins = Math.ceil((currentMins + 15) / 15) * 15; 
        
        for(let i = 0; i < 16; i++) { 
            let m = startMins + (i * 15);
            let hours = Math.floor(m / 60) % 24;
            let mins = m % 60;
            let ampm = hours >= 12 ? 'Ù…Ø³Ø§Ø¡Ù‹' : 'ØµØ¨Ø§Ø­Ø§Ù‹';
            let h12 = hours % 12 || 12;
            let formattedMins = mins < 10 ? '0' + mins : mins;
            let timeStr = `${h12}:${formattedMins} ${ampm}`;
            select.innerHTML += `<option value="${timeStr}">${timeStr}</option>`;
        }
    }

    function toggleTimeInput() {
        const type = document.querySelector('input[name="pickup-time-type"]:checked').value;
        const container = document.getElementById('scheduled-time-container');
        if (type === 'scheduled') {
            container.style.display = 'block';
            generateTimeOptions();
        } else {
            container.style.display = 'none';
        }
    }

    async function fetchMenuData() {
        try {
            const response = await fetch(csvUrl);
            const csvText = await response.text();
            const rows = csvText.split('\n').map(r => r.trim()).filter(r => r);
            
            for(let i = 1; i < rows.length; i++) {
                const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, '').trim());
                if(cols.length < 3) continue;

                let cat = cols[0];
                let name = cols[1];
                let valueRaw = cols[2];
                let priceRaw = valueRaw.replace(/[^\d.]/g, '');
                let price = parseFloat(priceRaw) || 0;

                if (cat === "Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯Ø§Øª") {
                    if (name === "Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨") whatsappNumber = valueRaw;
                    if (name === "Ø±Ù‚Ù… Ø§Ù„Ø§ØªØµØ§Ù„ 1") callNumber1 = valueRaw;
                    if (name === "Ø±Ù‚Ù… Ø§Ù„Ø§ØªØµØ§Ù„ 2") callNumber2 = valueRaw;
                    if (name === "Ø±Ø§Ø¨Ø· Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…") instaLink = valueRaw;
                    if (name === "Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ") fbLink = valueRaw;
                    if (name === "Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®ÙˆØ¶") locationLink1 = valueRaw;
                    if (name === "Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®ÙˆÙŠØ±") locationLink2 = valueRaw;
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (ÙƒØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)
                    if (name === "ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" || name === "ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„") {
                        deliveryTime = valueRaw.replace(/[^\d]/g, ''); 
                        if(!deliveryTime) deliveryTime = "20"; // Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ
                        const asapSpan = document.getElementById('asap-time-span');
                        if(asapSpan) asapSpan.innerText = deliveryTime;
                    }
                    continue;
                }

                if (cat === "Ø¬Ø¨Ù† Ø§Ø¶Ø§ÙÙŠ") continue;

                const mergedCats = ["Ù…Ø´Ø±ÙˆØ¨Ø§Øª", "Ø¨Ø§ÙƒØª Ø´ÙŠØ¨Ø³", "ÙƒÙˆÙ…Ø¨Ùˆ", "Ù…ÙŠØ§Ù‡", "Ø®Ø¨Ø²", "Ø¥Ø¶Ø§ÙØ§Øª", "ØµÙˆØµØ§Øª"];
                if (mergedCats.includes(cat)) {
                    cat = "Ø§Ø¶Ø§ÙØ§Øª ÙˆØ¬Ø¨Ø§Øª";
                }
                
                let img = cols[3] ? cols[3].replace(/[\[\]]/g, '') : '';
                if(name.includes("Ù‚Ø·Ø¹Ø© Ø§Ø³ØªØ±ÙŠØ¨Ø³")) {
                    img = "https://i.ibb.co/Vph8WY44/mmw-638669571739251392.webp";
                }

                let flv = cols[4] === 'Ù†Ø¹Ù…';
                let s = parseInt(cols[5]) || 0;
                let d = parseInt(cols[6]) || 0;

                if(name.includes("ØµÙˆØµØ§Øª Ù…ØªÙ†ÙˆØ¹Ø©")) s = Math.max(s, 1);
                if(name.includes("ÙƒÙˆÙ…Ø¨Ùˆ") || name.includes("Ù…Ø´Ø±ÙˆØ¨Ø§Øª ØºØ§Ø²ÙŠØ©")) d = Math.max(d, 1); 

                if(!menuData[cat]) menuData[cat] = [];
                menuData[cat].push({ id: i, name, price, img, flv, s, d, catOrigin: cat });
            }

            document.getElementById('call-btn-1').href = 'tel:' + callNumber1;
            document.getElementById('call-btn-1').innerHTML = 'ğŸ“ ' + callNumber1;
            document.getElementById('call-btn-2').href = 'tel:' + callNumber2;
            document.getElementById('call-btn-2').innerHTML = 'ğŸ“ ' + callNumber2;
            document.getElementById('insta-btn').href = instaLink;
            document.getElementById('fb-btn').href = fbLink;
            document.getElementById('loc-btn-1').href = locationLink1;
            document.getElementById('loc-btn-2').href = locationLink2;

            const btn = document.getElementById('start-btn');
            btn.innerText = "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸ—";
            btn.disabled = false;
        } catch(e) {
            console.error(e);
        }
    }

    function showPage(id) {
        document.querySelectorAll('.page-content, #home-page').forEach(p => p.style.display = 'none');
        document.getElementById(id).style.display = id === 'home-page' ? 'flex' : 'block';
    }

    function goToHome() { showPage('home-page'); document.getElementById('footer-nav').style.display='none'; }
    
    function goToMenu() { 
        showPage('menu-page'); 
        document.getElementById('footer-nav').style.display='block';
        renderTabs();
        if(!currentCategory) currentCategory = Object.keys(menuData)[0];
        showCategory(currentCategory);
    }

    function backToCurrentCategory() {
        showPage('menu-page');
        document.getElementById('footer-nav').style.display='block';
        renderTabs();
        showCategory(currentCategory);
    }

    function renderTabs() {
        const tabs = document.getElementById('cat-tabs');
        tabs.innerHTML = '';
        Object.keys(menuData).forEach((cat) => {
            const isActive = cat === currentCategory;
            tabs.innerHTML += `<button class="tab ${isActive ? 'active' : ''}" onclick="showCategory('${cat}', this)">${cat}</button>`;
        });
        setTimeout(() => {
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }, 100);
    }

    function showCategory(cat, btn = null) {
        currentCategory = cat; 
        if(btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
        }
        const list = document.getElementById('items-list');
        list.innerHTML = '';
        if(menuData[cat]) {
            menuData[cat].forEach(item => {
                list.innerHTML += `
                    <div class="item-card" onclick='initOptions(${JSON.stringify(item)})'>
                        <img src="${item.img || 'https://via.placeholder.com/110?text=Baraka'}" onerror="this.src='https://via.placeholder.com/110?text=Baraka'">
                        <div class="item-info">
                            <h3>${item.name}</h3>
                            <span class="price-tag">${item.price.toFixed(3)} Ø±.Ø¹</span>
                        </div>
                    </div>`;
            });
        }
    }

    function initOptions(item) {
        selectedItem = item;
        currentOptQty = 1;
        document.getElementById('opt-qty-val').innerText = currentOptQty;
        showPage('options-page');
        document.getElementById('item-title-head').innerText = item.name;
        
        let html = `<div class="opt-box"><h3>Ø§Ù„Ø³Ø¹Ø±: ${item.price.toFixed(3)} Ø±.Ø¹</h3></div>`;
        if(item.flv) html += `<div class="opt-box"><label>ğŸŒ¶ï¸ Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¹Ù…:</label><select id="sel-flv"><option>Ø¹Ø§Ø¯ÙŠ</option><option>Ø­Ø§Ø±</option></select></div>`;
        
        if(item.name.includes("ØªÙˆØ³ØªØ±") || item.name.includes("ØªØ±Ø¨Ù„ ØªÙˆØ³ØªØ±")) {
            html += `<div class="opt-box" style="border-color:var(--main-yellow)">
                <label>ğŸ§€ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¨Ù† Ø§Ø®ØªÙŠØ§Ø±ÙŠ (Ø­ØªÙ‰ 3 Ø´Ø±Ø§Ø¦Ø­):</label>
                <select id="sel-cheese">
                    <option value="0">Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ©</option>
                    <option value="0.100">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø¬Ø¨Ù† (+0.100 Ø±.Ø¹)</option>
                    <option value="0.200">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­ØªÙŠÙ† Ø¬Ø¨Ù† (+0.200 Ø±.Ø¹)</option>
                    <option value="0.300">Ø¥Ø¶Ø§ÙØ© 3 Ø´Ø±Ø§Ø¦Ø­ Ø¬Ø¨Ù† (+0.300 Ø±.Ø¹)</option>
                </select>
            </div>`;
        }

        if(item.d > 0) {
            for(let i=1; i<=item.d; i++) {
                html += `<div class="opt-box">
                    <label>ğŸ¥¤ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨ Ø§Ù„ØºØ§Ø²ÙŠ ${item.d > 1 ? i : ''}:</label>
                    <select class="sel-drink">${drinksUI}</select>
                </div>`;
            }
        }

        if(item.s > 0) {
            for(let i=1; i<=item.s; i++) {
                html += `<div class="opt-box">
                    <label>ğŸ§‚ Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØµ ${item.s > 1 ? i : ''}:</label>
                    <select class="sel-sauce">${saucesUI}</select>
                </div>`;
            }
        }
        
        html += `<div class="opt-box"><label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label><textarea id="sel-note" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø¯ÙˆÙ† Ø®Ø³ØŒ ÙƒØªØ´Ø¨ Ø²ÙŠØ§Ø¯Ø©..."></textarea></div>`;
        document.getElementById('options-render').innerHTML = html;
    }

    function changeOptQty(change) {
        currentOptQty += change;
        if(currentOptQty < 1) currentOptQty = 1;
        document.getElementById('opt-qty-val').innerText = currentOptQty;
    }

    function addItemToCart() {
        const cheeseSelect = document.getElementById('sel-cheese');
        const cheesePrice = cheeseSelect ? parseFloat(cheeseSelect.value) : 0;
        const cheeseText = cheeseSelect && cheesePrice > 0 ? cheeseSelect.options[cheeseSelect.selectedIndex].text : '';

        const finalItemPrice = selectedItem.price + cheesePrice;

        const entry = {
            name: selectedItem.name,
            qty: currentOptQty,
            unitPrice: finalItemPrice,
            totalPrice: finalItemPrice * currentOptQty,
            flv: document.getElementById('sel-flv')?.value || '',
            cheeseInfo: cheeseText,
            sauces: Array.from(document.querySelectorAll('.sel-sauce')).map(s => s.value),
            drinks: Array.from(document.querySelectorAll('.sel-drink')).map(d => d.value),
            note: document.getElementById('sel-note').value
        };
        cart.push(entry);
        document.getElementById('c-count').innerText = cart.length;
        backToCurrentCategory();
    }

    function goToCart() {
        showPage('cart-page');
        if(document.querySelector('input[name="pickup-time-type"]:checked').value === 'scheduled') {
            generateTimeOptions();
        }

        const display = document.getElementById('cart-display');
        display.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
            total += item.totalPrice;
            display.innerHTML += `
                <div class="opt-box" style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="flex:1;">
                        <strong style="font-size:1.1rem">${item.name} <span style="color:var(--main-red)">(Ã—${item.qty})</span></strong><br>
                        <small style="color:#666">
                            ${item.flv ? `Ø§Ù„Ø·Ø¹Ù…: ${item.flv} | ` : ''}
                            ${item.cheeseInfo ? `<br>ğŸ§€ ${item.cheeseInfo}` : ''}
                            ${item.sauces.length ? `<br>ğŸ§‚ ØµÙˆØµ: ${item.sauces.join('ØŒ ')}` : ''}
                            ${item.drinks.length ? `<br>ğŸ¥¤ Ù…Ø´Ø±ÙˆØ¨: ${item.drinks.join('ØŒ ')}` : ''}
                            ${item.note ? `<br>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: ${item.note}` : ''}
                        </small>
                        <div style="font-weight:bold; margin-top:5px; color:var(--main-red)">${item.totalPrice.toFixed(3)} Ø±.Ø¹</div>
                    </div>
                    <button onclick="remove(${idx})" style="color:red; border:none; background:none; font-size:1.5rem; cursor:pointer; padding:10px;">ğŸ—‘ï¸</button>
                </div>`;
        });
        document.getElementById('total-val').innerText = total.toFixed(3);
    }

    function remove(i) { cart.splice(i, 1); goToCart(); document.getElementById('c-count').innerText = cart.length; }

    function submitOrder() {
        if(!cart.length) {
            showAlert("Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙØ§Ø±ØºØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¬Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.");
            return;
        }
        
        const custName = document.getElementById('customer-name').value.trim();
        if(!custName) {
            showAlert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
            document.getElementById('customer-name').focus();
            return;
        }

        const branch = document.getElementById('branch-select').value;
        if(!branch) {
            showAlert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙØ±Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø®ÙˆØ¶ Ø£Ùˆ Ø§Ù„Ø®ÙˆÙŠØ±).");
            document.getElementById('branch-select').focus();
            return;
        }

        let finalPickupTimeText = `ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª (Ø®Ù„Ø§Ù„ ${deliveryTime} Ø¯Ù‚ÙŠÙ‚Ø©)`;
        const timeType = document.querySelector('input[name="pickup-time-type"]:checked').value;
        
        if (timeType === 'scheduled') {
            const timeVal = document.getElementById('scheduled-time-select').value;
            if (!timeVal) {
                showAlert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø¬Ùˆ Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.");
                return;
            }
            finalPickupTimeText = `Ø§Ù„Ø³Ø§Ø¹Ø© ${timeVal} (Ù…Ø¬Ø¯ÙˆÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹)`;
        }

        const pNotes = document.getElementById('pickup-notes').value.trim();

        const confirmMsg = `Ø¹Ø²ÙŠØ²ÙŠ ${custName}ØŒ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ ${branch} (Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹). Ø§Ø¶ØºØ· Ø­Ø³Ù†Ø§Ù‹ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.`;
        showAlert(confirmMsg);

        setTimeout(() => {
            let text = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨Ø±ÙƒØ© ğŸ—*\n`;
            text += `ğŸ”´ *Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹ ÙÙ‚Ø·*\n`;
            text += `ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${custName}*\n`;
            text += `ğŸ“ ÙØ±Ø¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: ${branch}\n`;
            text += `â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: *${finalPickupTimeText}*\n`;
            if(pNotes) text += `ğŸš— *Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…: ${pNotes}*\n`;
            text += `\n`;
            
            cart.forEach(i => {
                text += `â–ªï¸ *${i.name}* (Ø§Ù„Ø¹Ø¯Ø¯: ${i.qty})\n`;
                if(i.flv) text += `    - Ø§Ù„Ø·Ø¹Ù…: ${i.flv}\n`;
                if(i.cheeseInfo) text += `    - Ø§Ù„Ø¬Ø¨Ù†: ${i.cheeseInfo}\n`;
                if(i.sauces.length) text += `    - ØµÙˆØµ: ${i.sauces.join('ØŒ ')}\n`;
                if(i.drinks.length) text += `    - Ù…Ø´Ø±ÙˆØ¨: ${i.drinks.join('ØŒ ')}\n`;
                if(i.note) text += `    - Ù…Ù„Ø§Ø­Ø¸Ø©: ${i.note}\n`;
                text += `    - Ø§Ù„Ø³Ø¹Ø±: ${i.totalPrice.toFixed(3)} Ø±.Ø¹\n\n`;
            });
            text += `====================\nğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${document.getElementById('total-val').innerText} Ø±.Ø¹*\n====================`;
            
            window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(text)}`);
        }, 1500);
    }

    fetchMenuData();
</script>
</body>
</html>
